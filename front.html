<html>
<head>
	<title>Stock Market Search</title>
	<script src="//code.jquery.com/jquery-1.10.2.js"></script>
	<link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
	<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
	<script src="https://code.highcharts.com/stock/highstock.js"></script>
	<script src="https://code.highcharts.com/stock/modules/exporting.js"></script>
	<link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
	<script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.3/moment.js"></script>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<script type="text/javascript">

	$( document ).ready(function() {
		chartString = '';
		var img;
		var symbol;
		var name;
		var price;
		var change;
		var changePercent;
		var marketCap;
		$("#refresh").bootstrapToggle("off");
		var link;

		$(function(){
			if(localStorage.getItem("symbol") != null){
				var refreshedSymbols = JSON.parse(localStorage.getItem("symbol"));
				console.log(refreshedSymbols);
				var tab = $("#favoriteTable tbody");
				for(var j= 0;j<refreshedSymbols.length+1;j++)
				{
					var row = $("<tr></tr>");
					tab.append(row);
				}

				for(var i = 0;i<refreshedSymbols.length;i++){
					var storedSymbol = refreshedSymbols[i];
					buildTable(storedSymbol, i+1);	
				}
			}	
		})

		function buildTable(storedSymbol, i){
			$.ajax({
						url: 'http://stocksearch.itzugpsbwa.us-west-2.elasticbeanstalk.com/',
						dataType: 'json',
						type: 'GET',
						data:{
							name: storedSymbol
						},
						success: function(output){
							var fancyChange = parseFloat(output.Change).toFixed(2) +' ('+ parseFloat(output.ChangePercent).toFixed(2)+'%)';
							if(output.Change>0){

								console.log($("#favoriteTable").children("tr"[i+1]));

								$("#favoriteTable tr").eq(i).html('<td><a href="" id="favoriteTableLink">'+output.Symbol+"<a href=''>"+'</td><td>'+output.Name+'</td><td id="price'+output.Symbol+'">'+'$ '+output.LastPrice+'</td><td id="change'+output.Symbol+'" style="color:green">'+fancyChange+'<img src="http://cs-server.usc.edu:45678/hw/hw8/images/up.png"</td><td>'+formatFunction(output.MarketCap)+'</td><td><button class="btn btn-default trash" id="trash"><span class="glyphicon glyphicon-trash"></span></button></td>') ;
							}
							else if(output.Change<0){
								$("#favoriteTable tr").eq(i).html('<td><a href="" id="favoriteTableLink">'+output.Symbol+"<a href=''>"+'</td><td>'+output.Name+'</td><td id="price'+output.Symbol+'">'+'$ '+output.LastPrice+'</td><td id="change'+output.Symbol+'" style="color:red">'+fancyChange+'<img src="http://cs-server.usc.edu:45678/hw/hw8/images/down.png"</td><td>'+formatFunction(output.MarketCap)+'</td><td><button class="btn btn-default trash" id="trash"><span class="glyphicon glyphicon-trash"></span></button></td>');
							}
							else
								$("#favoriteTable tr").eq(i).html('<td><a href="" id="favoriteTableLink">'+output.Symbol+"<a href=''>"+'</td><td>'+output.Name+'</td><td id="price'+output.Symbol+'">'+'$ '+output.LastPrice+'</td><td id="change'+output.Symbol+'>'+fancyChange+'</td><td>'+formatFunction(output.MarketCap)+'</td><td><button class="btn btn-default trash" id="trash"><span class="glyphicon glyphicon-trash"></span></button></td>') ;

						} 
					});		
		}

		function formatFunction(number){
			var billionThreshold = Math.floor(number/1000000000);
	        var formattedMarketCapBillion = number/1000000000;
	        var millionThreshold = Math.floor(number/1000000);
	        var formattedMarketCapMillion =  number/1000000;
	                 
			if(billionThreshold>0){
				 var fixedValue=parseFloat(formattedMarketCapBillion).toFixed(2)+" Billion";
			}

			else if(millionThreshold>0){
				var fixedValue = parseFloat(formattedMarketCapMillion).toFixed(2)+" Million";
			}
			
			else {
				var fixedValue = parseFloat(number).toFixed(2);
			}
			console.log("fV"+fixedValue);
			return fixedValue;
		}


		$(document).on('click','#favoriteTableLink', function(e){
			//symbol = $("#name").val();
				symbol = $('td:first',$(this).closest('tr')).text();
				getNews(symbol);
				getChart(symbol);
				e.preventDefault();
				var checkSymbols = JSON.parse(localStorage.getItem("symbol"));
				console.log(checkSymbols);
				if(checkSymbols != null){
					if(checkSymbols.indexOf(symbol)!=-1){
						$("#saveButton").css('color','yellow');
					}
				}
				console.log(symbol+"1");
				$("#rightButton").removeAttr('disabled');
				console.log(symbol+"2");
				$.ajax({
					url: 'http://stocksearch.itzugpsbwa.us-west-2.elasticbeanstalk.com/',
					dataType: 'json',
					type: 'GET',
					data:{
						name: symbol
					},
					success: function(output){
						//current stock image
						console.log(symbol);
						if(output.Message != undefined){
							showErrorMessage();
						}
						else {
							$("#myCarousel").carousel("next");
							hideErrorMessage();
							var pic = document.getElementById("rightImage");
							pic.src = 'http://chart.finance.yahoo.com/t?s='+symbol+'&lang=en-US&width=400&height=300';
							console.log(pic);
							var table = $("<table class = \"table table-striped\">").attr("id","mytable");
							$("#rightBody").append(table);
							var tr="<tr>";
							var ntr="</tr>";
							var th="<th>";
							var nth="</th>";
							var td="<td>";
							var ntd="</td>";
						    var td1=tr+th+"Name"+nth+td+output.Name+ntd+ntr;
						    name = output.Name;
						    var td2=tr+th+"Symbol"+nth+td+output.Symbol+ntd+ntr;
						     
						    var roundedLastPrice = Math.round(output.LastPrice * 100) / 100;
						    price = roundedLastPrice;

							var td3=tr+th+"Last Price"+nth+td+"$ "+roundedLastPrice+ntd+ntr;

							var roundedChange = parseFloat(output.Change).toFixed(2);
							change = roundedChange;
							var roundedChangePercent = parseFloat(output.ChangePercent).toFixed(2);
							changePercent = roundedChangePercent;
							
							if(roundedChange>0){
								var td4=tr+th+"Change (ChangePercent)"+nth+"<td style='color: green;'>"+roundedChange+" ("+roundedChangePercent+"%) "+"<img src='http://cs-server.usc.edu:45678/hw/hw8/images/up.png'>"+ntd+ntr;
								//var td5=tr+th+"Change Percent"+nth+td+output.ChangePercent+ntd+ntr;
							}
							else
								var td4=tr+th+"Change (ChangePercent)"+nth+"<td style='color: red;'>"+roundedChange+" ("+roundedChangePercent+"%) "+"<img src='http://cs-server.usc.edu:45678/hw/hw8/images/down.png'>"+ntd+ntr;

							var formattedTime =	moment(output.Timestamp).format('DD MMMM YYYY, h:mm:ss a'); 

							var td6=tr+th+"Timestamp"+nth+td+formattedTime+ntd+ntr;
							marketCap = output.MarketCap;
							console.log("variable is "+marketCap);
							var td8=tr+th+"Market Cap"+nth+td+formatFunction(output.MarketCap)+ntd+ntr;
							var td9=tr+th+"Volume"+nth+td+output.Volume+ntd+ntr;
							var roundedChangeYTD = Math.round(output.ChangeYTD * 100) / 100;
							var roundedChangePercentYTD = Math.round(output.ChangePercentYTD * 100) / 100;

							if(roundedChangePercentYTD>0){

								var td10 = tr+th+"Change YTD (ChangePercent YTD)"+nth+"<td style='color: green;'>"+roundedChangeYTD+" ("+roundedChangePercentYTD+"%) "+"<img src='http://cs-server.usc.edu:45678/hw/hw8/images/up.png'>"+ntd+ntr;

							}

							else td10 = tr+th+"Change YTD (ChangePercent YTD)"+nth+"<td style='color: red;'>"+roundedChangeYTD+" ("+roundedChangePercentYTD+"%) "+"<img src='http://cs-server.usc.edu:45678/hw/hw8/images/down.png'>"+ntd+ntr;

							var td12=tr+th+"High"+nth+td+"$ "+(Math.round(output.High*100)/100)+ntd+ntr;
							var td13=tr+th+"Low"+nth+td+"$ "+(Math.round(output.Low*100)/100)+ntd+ntr;
							var td14=tr+th+"Open"+nth+td+"$ "+(Math.round(output.Open*100)/100)+ntd+ntr;

							$("#mytable").html(td1+td2+td3+td4+td6+td8+td9+td10+td12+td13+td14);
							$("#rightBody").append("</table>");
						}
					}
				});	
		})

    	$('#name').autocomplete({
    		source: function(request, response){
				$.ajax({
					dataType: "json",
					type: 'GET',
					url: 'http://stocksearch.itzugpsbwa.us-west-2.elasticbeanstalk.com/',
					data:{
						action: request.term
					},
					success: function(output){
						console.log(output);
						response($.map(output, function(item){
							return {
								label: item.Symbol +' - '+ item.Name+' ('+item.Exchange+')',
								value: item.Symbol
							}
						}));
						},
					error: function(error){
						console.log(error)
					}	
				});
			},
		});
	
    	function showErrorMessage(){
    		$("#error").css('visibility','visible');
    	}

    	function hideErrorMessage(){
    		$("#error").css('visibility','hidden');
    	}

    	$(function(){
    		$("#clear").on('click',function(e){
    			console.log("clear");
    			e.preventDefault();
    			$("#name").val("");
    			$("#rightButton").attr('disabled','true');
    			hideErrorMessage();
    		});
    	})

		$(function(){
			$("#inputForm").submit(function(e){
				console.log("bleh");
				symbol = $("#name").val();
				e.preventDefault();
				var checkSymbols = JSON.parse(localStorage.getItem("symbol"));
				console.log(checkSymbols);
				if(checkSymbols != null){
					if(checkSymbols.indexOf(symbol)!=-1){
						$("#saveButton").css('color','yellow');
					}
					else $("#saveButton").css('color','white');
				}
				console.log(symbol+"1");
				console.log(symbol+"2");
				$.ajax({
					url: 'http://stocksearch.itzugpsbwa.us-west-2.elasticbeanstalk.com/',
					dataType: 'json',
					type: 'GET',
					data:{
						name: symbol
					},
					success: function(output){
						//current stock image
						console.log(symbol);
						if(output.Status == "Failure|APP_SPECIFIC_ERROR"){
							console.log("in here");
							$("#error").text("Data Not Available");
							$("#error").show();
						}
						else{
							if(output.Message != undefined){
								showErrorMessage();
							}
							else {
								getNews(symbol);
								getChart(symbol);
								$("#rightButton").removeAttr('disabled');
								$("#myCarousel").carousel("next");
								hideErrorMessage();
								var pic = document.getElementById("rightImage");
								pic.src = 'http://chart.finance.yahoo.com/t?s='+symbol+'&lang=en-US&width=400&height=300';
								console.log(pic);
								var table = $("<table class = \"table table-striped\">").attr("id","mytable");
								$("#rightBody").append(table);
								var tr="<tr>";
								var ntr="</tr>";
								var th="<th>";
								var nth="</th>";
								var td="<td>";
								var ntd="</td>";
							    var td1=tr+th+"Name"+nth+td+output.Name+ntd+ntr;
							    name = output.Name;
							    var td2=tr+th+"Symbol"+nth+td+output.Symbol+ntd+ntr;
							     
							    var roundedLastPrice = Math.round(output.LastPrice * 100) / 100;
							    price = roundedLastPrice;

								var td3=tr+th+"Last Price"+nth+td+"$ "+roundedLastPrice+ntd+ntr;

								var roundedChange = Math.round(output.Change * 100) / 100;
								change = roundedChange;
								var roundedChangePercent = Math.round(output.ChangePercent * 100) / 100;
								changePercent = roundedChangePercent;
								
								if(roundedChange>0){
									var td4=tr+th+"Change (ChangePercent)"+nth+"<td style='color: green;'>"+roundedChange+" ("+roundedChangePercent+"%) "+"<img src='http://cs-server.usc.edu:45678/hw/hw8/images/up.png'>"+ntd+ntr;
									//var td5=tr+th+"Change Percent"+nth+td+output.ChangePercent+ntd+ntr;
								}
								else
									var td4=tr+th+"Change (ChangePercent)"+nth+"<td style='color: red;'>"+roundedChange+" ("+roundedChangePercent+"%) "+"<img src='http://cs-server.usc.edu:45678/hw/hw8/images/down.png'>"+ntd+ntr;

								var formattedTime =	moment(output.Timestamp).format('DD MMMM YYYY, h:mm:ss a'); 

								var td6=tr+th+"Timestamp"+nth+td+formattedTime+ntd+ntr;
			
								var td8=tr+th+"Market Cap"+nth+td+formatFunction(output.MarketCap)+ntd+ntr;
								marketCap = output.MarketCap;
								var td9=tr+th+"Volume"+nth+td+output.Volume+ntd+ntr;
								var roundedChangeYTD = Math.round(output.ChangeYTD * 100) / 100;
								var roundedChangePercentYTD = Math.round(output.ChangePercentYTD * 100) / 100;

								if(roundedChangePercentYTD>0){

									var td10 = tr+th+"Change YTD (ChangePercent YTD)"+nth+"<td style='color: green;'>"+roundedChangeYTD+" ("+roundedChangePercentYTD+"%) "+"<img src='http://cs-server.usc.edu:45678/hw/hw8/images/up.png'>"
									+ntd+ntr;

								}

								else td10 = tr+th+"Change YTD (ChangePercent YTD)"+nth+"<td style='color: red;'>"+roundedChangeYTD+" ("+roundedChangePercentYTD+"%) "+"<img src='http://cs-server.usc.edu:45678/hw/hw8/images/down.png'>"+ntd+ntr;

								var td12=tr+th+"High"+nth+td+"$ "+(Math.round(output.High*100)/100)+ntd+ntr;
								var td13=tr+th+"Low"+nth+td+"$ "+(Math.round(output.Low*100)/100)+ntd+ntr;
								var td14=tr+th+"Open"+nth+td+"$ "+(Math.round(output.Open*100)/100)+ntd+ntr;

								$("#mytable").html(td1+td2+td3+td4+td6+td8+td9+td10+td12+td13+td14);
								$("#rightBody").append("</table>");

							}
						}
					}
				});	
			});
		})	

		function getNews(symbol){
			console.log("in news "+symbol);
				$.ajax({
					url: 'http://stocksearch.itzugpsbwa.us-west-2.elasticbeanstalk.com/',
					dataType: 'json',
					type: 'GET',
					data:{
						company: symbol
					},
					success: function(output){
						//console.log(output);
						$("#newsFeedBody").empty();
						var len = (output.d.results).length;
						console.log(len);
						for(var i=0;i<output.d.results.length;i++){
							var div = document.createElement('div');
							var $newDiv = $("<div/>").addClass("well well-sm").css('width','98%').css('margin','auto').css('margin-top','20px');
							//div.addClass("well well-sm");
						
							var formattedTitle = output.d.results[i].Title;
							var publisher = output.d.results[i].Source;
							var formattedLinkTitle = formattedTitle.link(output.d.results[i].Url);	 
							var formattedTime =	moment(output.d.results[i].Date).format('DD MMMM YYYY hh:mm:ss '); 

							$newDiv.html(formattedLinkTitle+"<br/><br/>" +output.d.results[i].Description+"<br/><br/>"+"<strong>Publisher: "+publisher+"</strong><br/><br/><strong>Date: "+formattedTime+"</strong><br/><br/>");

							console.log(div);	
							$('#newsFeedBody').append($newDiv);
						}
					}
				});	
		}
	
		function savedTableUpdate(){
			var savedSymbols = JSON.parse(localStorage.getItem("symbol"));
			if(savedSymbols != null){
				for(var i = 0; i<savedSymbols.length; i++){
					$.ajax({
						dataType:'json',
						type:'GET',
						url: 'http://stocksearch.itzugpsbwa.us-west-2.elasticbeanstalk.com/',
						data:{
							name: savedSymbols[i]
						},
						success: function(output){
							console.log("rught");
							var newValue = parseFloat(output.Change).toFixed(2) +' ('+ parseFloat(output.ChangePercent).toFixed(2) +'%)';
							$("#price"+output.Symbol).html(output.LastPrice);
							if(output.Change>0)
								$("#change"+output.Symbol).html(newValue+"<img src='http://cs-server.usc.edu:45678/hw/hw8/images/up.png'>");
							else if(output.change<0)
								$("#change"+output.Symbol).html(newValue+"<img src='http://cs-server.usc.edu:45678/hw/hw8/images/down.png'>");
						}
					});
				}
			} 
		}

		function autoRefresh(checked) {
			var time;
			if(checked){
				time = setTimeout(function(){
					autoRefresh($("#refresh").is(":checked"));
				}, 5000);
				console.log("yes");
				savedTableUpdate();
			}
			else {
				console.log("no");
				clearTimeout(time);
			}
		}

		$("#selfRefresh").click(function(e) {
				console.log("ref button pressed");
				savedTableUpdate();
		});

		$("#refresh").change(function(e) {
				var checked = $("#refresh").is(":checked");
				autoRefresh(checked);
		});

		$("#historicalCharts").on('click', function(){
			if(chartString != $('#name').val()){
				var chart = $('##historicalChartsBody').highcharts();
				chart.destroy();
				chartString = $('#name').val();
				getChart(chartString);
			}
		});

		function getChart(symbol){
			$.ajax({
				url: 'http://stocksearch.itzugpsbwa.us-west-2.elasticbeanstalk.com/',
				dataType: 'json',
				type: 'GET',
				data:{
					chart: symbol
				},
				success: function(output){
					console.log(output);
						
						var dataArray = [];
            		for (var i = 0; i < output.Dates.length; i++) {
	                    	var d = new Date(output.Dates[i] + 'Z');
              	    	dataArray.push([d.getTime(), output.Elements[0].DataSeries.close.values[i]]);
            		}
            		render(dataArray);
				}
			});	
		}

		function render(chart) {
			console.log("hi")
			// split the data set into ohlc and volume
			var ohlc = chart;

			// create the chart
			$('#historicalChartsBody').highcharts('StockChart', {
				
				rangeSelector: {
					selected: 0,
					buttons: [{
                		type: 'week',
		                count: 1,
		                text: '1w'
		            }, {
                		type: 'month',
		                count: 1,
		                text: '1m'
		            }, {
                		type: 'month',
		                count: 3,
		                text: '3m'
		            }, {
                		type: 'month',
		                count: 6,
		                text: '6m'
		            },{
                		type: 'ytd',
		                text: 'YTD'
		            },{
                		type: 'year',
		                count: 1,
		                text: '1y'
		            },{
		                type: 'all',
		                text: 'All'
		            }]

					//enabled: false
				},

				title: {
					text: symbol + ' Stock Value'
				},
				exporting: {
					enabled: false
				},

				yAxis: {
					min:0,
					title: {
						text: 'Stock Value'
					}
				},
				
				series: [{
					type: 'area',
					name: symbol,
					data: chart,
					threshold: null,
					tooltip : {
						valueDecimals : 2,
						valuePrefix: '$'
					},
					fillColor : {
						linearGradient : {
							x1: 0,
							y1: 0,
							x2: 0,
							y2: 1
						},
						stops : [
							[0, Highcharts.getOptions().colors[0]],
							[1, Highcharts.Color(Highcharts.getOptions().colors[0]).setOpacity(0).get('rgba')]
						]
					}
				}],
			});
		}

	window.fbAsyncInit = function() {
    	FB.init({
	      appId      : '800728840030941',
	      xfbml      : true,
	      version    : 'v2.5'
    	});
	};

	(function(d, s, id){
		var js, fjs = d.getElementsByTagName(s)[0];
		if (d.getElementById(id)) {
			return;
		}
		js = d.createElement(s); js.id = id;
		js.src = "//connect.facebook.net/en_US/sdk.js";
		fjs.parentNode.insertBefore(js, fjs);
	}(document, 'script', 'facebook-jssdk'));

	$(document).on('click','#shareButton',function(e){
		e.preventDefault();
		var hell = $('#rightImageBody').children('img').attr('src');
	
		console.log(hell);
		FB.ui({
			method: 'share',
			title: 'Current Stock Price of '+name+' is '+price,
			href: 'http://dev.markitondemand.com/MODApis/',
			picture: $('#rightImageBody').children('img').attr('src'),
			caption: 'Last Traded Price: $ '+price+', CHANGE: '+change+'( '+changePercent+'%)',
			description: "STOCK INFORMATION OF "+name+" ("+symbol+")",
		},

		function(response) {
				if(response && !response.error_message) {
					alert('Posted successfully');
				}
				else {
					alert('Not Posted');
				}
			}
		);		
	});

	$('#favoriteTable').on('click', '.trash', function() {
		console.log("in deletion func");
		$(this).closest('tr').remove();		
		var sym = $('td:first',$(this).closest('tr')).text();
		deleteFromLocalStorage(sym);
	});


	$(function(){
		$("#saveButton").click(function(e){

			var currentColor = $("#saveButton").css('color');
			if(currentColor == "rgb(255, 255, 0)"){
				$("#saveButton").css('color','white');
				//deleteFromLocalStorage(symbol);
				deleteFromTable(symbol);
			}
			else{
				var retrievedSymbols = JSON.parse(localStorage.getItem("symbol"));
				if(retrievedSymbols == null){
					retrievedSymbols = [];
					$("#saveButton").css('color','white');
				}
				if( retrievedSymbols == null || retrievedSymbols.length == 0 || retrievedSymbols.indexOf(symbol) == -1){
					retrievedSymbols.push(symbol);
					localStorage.setItem("symbol", JSON.stringify(retrievedSymbols));	
					$("#saveButton").css('color','yellow');

					$.ajax({
						url: 'http://stocksearch.itzugpsbwa.us-west-2.elasticbeanstalk.com/',
						dataType: 'json',
						type: 'GET',
						data:{
							name: symbol
						},
						success: function(output){
							var fancyChange = parseFloat(output.Change).toFixed(2) +' ('+ parseFloat(output.ChangePercent).toFixed(2)+'%)';
							if(output.Change>0){
								$("#favoriteTable").append('<tr><td><a href="" id="favoriteTableLink">'+output.Symbol+"<a href=''>"+'</td><td>'+output.Name+'</td><td id="price'+output.Symbol+'">'+'$ '+output.LastPrice+'</td><td id="change'+output.Symbol+'" style="color:green">'+fancyChange+'<img src="http://cs-server.usc.edu:45678/hw/hw8/images/up.png"</td><td>'+formatFunction(output.MarketCap)+'</td><td><button class="btn btn-default trash" id="trash"><span class="glyphicon glyphicon-trash"></span></button></td></tr>') ;
							}
							else if(output.Change<0){
								$("#favoriteTable").append('<tr><td><a href="" id="favoriteTableLink">'+output.Symbol+"<a href=''>"+'</td><td>'+output.Name+'</td><td id="price'+output.Symbol+'">'+'$ '+output.LastPrice+'</td><td id="change'+output.Symbol+'" style="color:red">'+fancyChange+'<img src="http://cs-server.usc.edu:45678/hw/hw8/images/down.png"</td><td>'+formatFunction(output.MarketCap)+'</td><td><button class="btn btn-default trash" id="trash"><span class="glyphicon glyphicon-trash"></span></button></td></tr>');
							}
							else
								$("#favoriteTable").append('<tr><td><a href="" id="favoriteTableLink">'+output.Symbol+"<a href=''>"+'</td><td>'+output.Name+'</td><td id="price'+output.Symbol+'">'+'$ '+output.LastPrice+'</td><td id="change'+output.Symbol+'>'+fancyChange+'</td><td>'+formatFunction(output.MarketCap)+'</td><td><button class="btn btn-default trash" id="trash"><span class="glyphicon glyphicon-trash"></span></button></td></tr>');
						} 
					});		
				}
				
				else if(retrievedSymbols.indexOf(symbol)!=-1 && currentColor == "rgb(255, 255, 0)"){
					deleteFromLocalStorage(symbol);
				}
			}
		});
	})


		
	function deleteFromLocalStorage(symb){
		var toBeDeletedArray = JSON.parse(localStorage.getItem("symbol"));
		console.log("toBeDeletedArray is "+toBeDeletedArray);
		var index = toBeDeletedArray.indexOf(symb);
		toBeDeletedArray.splice(index, 1);
		localStorage.clear();
		localStorage.setItem("symbol",JSON.stringify(toBeDeletedArray));
	}


	function deleteFromTable(symb){
		console.log("deleti")
		var tableData = document.getElementById("favoriteTable");
		var tabId = '#favoriteTable tr';
		var rowcount = $(tabId).length;         
		for (var i = 0; i < rowcount; i++) {
			var sym = $(tabId).eq(i).children('td').eq(0).text();
			if (null != sym && symb == sym) {
				console.log("found it");
				tableData.deleteRow(i);
				break;
			}
		}
		deleteFromLocalStorage(symb);
	}

	$("#rightButton").click(function() {
            $('.carousel').carousel('next');
        })
        $("#leftButton").click(function() {
            $('.carousel').carousel('prev');
        })


	});		
	</script>

	<style type="text/css">

	body {
		background: #356684;
	}

	#historicalChartsBody {
		width: 96%;
		margin-left: auto;
		margin-right: auto;
		margin-bottom: 80px;
	}

	#formDiv {
		width: 80%;
		height: 150px;
		position: relative;
		margin: auto;
		text-align: center;
		top: 15px;
	}

	#firstLine {
		position: relative;
		left: -80px;
	}

	#star {
		color: red;
		left: -80px;
		position: relative;
	}


	#rightButton {
		height: 30px;
		margin-top: -7px;
		margin-left: 4px;
	}

	#fl {
		color: black;
	}

	#refresh {
		color: black;
		position: relative;
		left: 300px;
	}

	#myTabContent {

	}

	#myTable {
		position: relative;
		width: 100%;
	}

	#rightImage {
		width: 100%;

	}

	#newsFeedBody {
		margin-top: -30px;
	}

	#rightImageBody{
		position: relative;
	}

	

	th {
		font-size: 13px;
	}

	#shareButton {
		float: right;
		margin-top: -19px;
		border: 0;
		padding: 0;
		margin-right: 10px;
	}

	#saveButton {
		float: right;
	    margin-top: -19px;
	    height: 40px;
	    margin-right: 44;
	    width: 40px;
	}

	#stockMarketSearchDiv {
		position: relative;
	}

	#header {
		text-align: center;
	}	
	#inputForm {
		text-align: center;
	}
	#topContainer {	
		padding-top: 10px;
		margin-top: 10px;
	}
	#containerBody {
	}
	#favoriteTable {
		text-align: center;
	}
	#navPillsContainer {
		top: 30px;
		position: relative;
	}
	#refreshLine {
		margin-right: 100px;
		position: relative;
		left: 55px;
	}
	#selfRefresh {		
		width: 40px;
		height: 33px;
		margin-top: -8px;
	}

	hr {
		display: block;
	    margin: auto;
	    margin-bottom: 20px;
	    border-style: inset;
	    border-width: 0.1px;
		border-color:white; 
		width: 100%;
	}

	#rightBody {
		margin-top: 35px;
	}

	#refreshSpan {
		margin-left: 
	}
	#refreshLabel {
		position: relative;
		bottom: 8px;
	}

	.highcharts-input-group {
		visibility: hidden;
	}

	#myCarousel {
		position: relative;;
		margin: auto;
		width: 100%;
	}

	#navDiv {
		text-align: left;
		margin-top: 30px;
		margin-left: auto;
		margin-right: auto;
		width: 100%;
		height: 12%;
	}

	#secondPageHeading{
		position: relative;
		margin: auto;
		text-align: center;
	}

	#car {
		border: 1px solid #dcdcdc;
		margin-top: -60px;
	}

	#innerContainerBody {
		margin-top: -30px;
		width: 99%;
	}

	.panel-body {
		background: white;
	}

	#panelSecondSlideHeading {
		height: 60px;
	}

	#favoriteTableDiv {
		width: 95%;
	}

	#formGroup1 {
		text-align: center;
	}

	#name {
		position: relative;
	}

	#submit {
    	margin-right: 10px;
	}
	
	#buttonDiv {
		height: 80px;
	}

	#head {
	    margin-top: 30px;
	    margin-left: 19px;
	    margin-bottom: -10px;
	}

	#power {
		margin-left: -9%;
	}

	@media (max-width: 767px) {
  		.nav-pills.nav-justified > li {
	    float: left;
	    width: 50%;
	  	}
	  	body {
	  		padding: 5px;
	  	}
	  	#refreshLine {
	  		display: none;
	  	}
	  	#feedSpan {
	  		display: none;
	  	}
		#currentSpan {
	  		display: none;
	  	}
	  	#historicalSpan {
	  		display: none;
	  	}
	  
	}

	</style>
</head>
<body id="body">
	<div id="topContainer" class="container">
		<div class="row">
			<div class="well well-lg white">
				<form id="inputForm" action="" method="GET">
					<div id="formGroup1" class="row">
						<h4 id="headingLine" class="col-xs-12 heading">Stock Market Search</h4>
					</div>	
					<div class="row" >
						<div class="col-md-4 col-sm-5">
						<label for="input" >Enter the stock name or symbol: <span style="color: red">*</span></label>
						</div>
						<input type="text" id="name" name="name" value="" class="col-xs-12 col-md-4 col-sm-5" placeholder="Apple or AAPL" required>
						<div class=" col-md-4 col-sm-12 clearfix" style="text-align: left;">
							<button class="btn btn-primary btn-sm" type="submit" id="submit" name="submit"><span class="glyphicon glyphicon-search"></span>Get Quote</button><button class="btn btn-default btn-sm" type="button" name="clear" id="clear"><span class="glyphicon glyphicon-refresh"></span>Clear</button>
						</div>
					</div>	
					<div class="row">
						<div class="col-xs-12 col-md-3">
						</div>
						<div id="error" class="col-xs-12 col-md-6" style="visibility: hidden; color: red; text-align: left">Select a valid entry</div>
						<div class="col-xs-12 col-md-3" id="power" >Powered By: <a href="http://www.markit.com/product/markit-on-demand" target="_blank"><img src="http://cs-server.usc.edu:45678/hw/hw8/images/mod-logo.png" height="25px" width="150px"></a>
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>						
						

	<div id="carouselConatiner" class="container well well-lg">
		<div class="row">
			<div id="myCarousel" class="col-md-10 col-xs-12 col-md-offset-1 carousel slide" data-wrap="false" data-ride="carousel" data-interval="false"> 
				<div class="carousel-inner" role="listbox">
					<div class="item active">
						<div class="panel panel-default">
							<div class="panel-heading">
								<a href="#myCarousel" role="button">
									<Button class="btn btn-default btn-md pull-right" type=button id="rightButton" disabled>
										<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
										<span class="sr-only">Next</span>
									</Button>
								</a>	
			 					<span id="fl"><strong>Favorite List</strong></span>
			 					<button type="button" id="selfRefresh" class="btn btn-default btn-md pull-right"><span id="clearFavorite" class="glyphicon glyphicon-refresh"></span></button>
			 					<label id="refreshLabel" class="checkbox-inline pull-right"><span id="refreshLine">Automatic Refresh:</span><span id="refreshSpan"><input id="refresh" type="checkbox" data-toggle="toggle"></span></label>
			 				</div>	
			 				<div id="favoriteTableDiv" class="container panel-body">
				 				<div class="row">
				 					<table class="table table-striped table-resonsive" id="favoriteTable">
				 					<tr>
				 						<td>Symbol</td>
				 						<td>Company Name</td>
				 						<td>Stock Price</td>
				 						<td>Change (Change Percent)</td>
				 						<td>Market Cap</td>
				 						<td></td>
			 						</tr>
			 						</table>
			 					</div>
		 					</div>
	 					</div>
		 			</div>	
		 			<div class="item">
			 			<div id="headingBackground" class="panel panel-default">
			 				<div class="panel-heading" id="panelSecondSlideHeading">
					 			<a href="#myCarousel" role="button">
									<Button class="btn btn-default btn-md pull-left" type=button id="leftButton">
										<span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
										<span class="sr-only">Previous</span>
									</Button>
								</a>
								<h5 id="secondPageHeading"><strong>Stock Details</strong></h5>
							</div>
							<br>
							<br>
							<div id="car" class="panel-body">
								<div id="navDiv">
								<ul class="nav nav-pills pull-left" id="myTab">
						 			<li class="active" id="currentStock"><a href="#containerBody"  data-toggle="pill"><i class="glyphicon glyphicon-dashboard"></i></span><span id="currentSpan"> Current</span> Stock</a></li>
						 			<li id="historicalCharts"><a href="#historicalChartsBody" data-toggle="pill"><i class="glyphicon glyphicon-stats"></i><span id="historicalSpan"> Historical</span> Charts</a></li>	
						 			<li id="newsFeed" ><a href="#newsFeedBody" data-toggle="pill"><i class="glyphicon glyphicon-link"></i> News <span id="feedSpan">Feed</span></a>	
								</ul>		
								</div>
								<hr>
					 		<br>
					 		<br>
					 			<div class="tab-content" id="myTabContent">
					 						<div class="tab-pane active" id="containerBody">
					 							<div class="container" id="innerContainerBody">
					 								<div class="row" id="buttonDiv">
					 									<h4 id="head">Stock Details</h4>
					 									<button type="button" id="saveButton" class="btn btn-default btn-lg well well-sm"><span class="glyphicon glyphicon-star"></span></button>
					 									<button id="shareButton"><img src="https://c866088.ssl.cf3.rackcdn.com/assets/facebook40x40.png" border=0></button>
												 		<div id="rightBody" class="col-md-6 col-sm-10 col-xs-10"></div>	
											 		</div>	
											 		<div id="rightImageBody" class="col-md-6 col-sm-12 col-xs-12">
											 			<img id="rightImage">
											 		</div>
										 		</div>
								 			</div>
						 			<div id="historicalChartsBody" class="tab-pane"></div>
						 			<div id="newsFeedBody" class="tab-pane"></div>
					 			</div>
					 		</div>	
				 		</div>	
			 		</div>
				</div>	
			</div>	
		</div>	
	</div>
	
	<div id="container" style="height: 400px; min-width: 310px"></div>
	<div id="currentStockImage"></div>
	<div id="newsDiv"></div>

</body>
</html>
